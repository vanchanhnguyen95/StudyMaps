VM146
IP: 10.0.10.146
Cổng Remote: 13389
Cổng SSH: 5522
Tài khoản: kcn
Mật khẩu: mqBZh*P@
Tài khoản: root
Mật khẩu: b5JrXs4FPJp4ftGK#CRnjv%G
mqBZh*P@
mv elasticsearch-7.3.1 /es



Lưu ý: nên dùng ES 7.3.1, các version cũ crash loạn xạ với Java core dump !

sudo su
apt-get update -y
apt-get upgrade -y
apt-get install build-essential cmake unzip pkg-config gcc-7 g++-7 -y
apt-get install wget curl nano git -y

cd /

*** Tải ElasticSearch 7.3.1
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.1-linux-x86_64.tar.gz
tar -xzf elasticsearch-7.3.1-linux-x86_64.tar.gz
mv elasticsearch-7.3.1 /data/elasticsearch-7.3.1

export PATH=$PATH:/data/elasticsearch-7.3.1/jdk/bin
export JAVA_HOME=/data/elasticsearch-7.3.1/jdk
export ES_JAVA_HOME=/data/elasticsearch-7.3.1/jdk

** Tải ES Analysis Vietnam
wget https://github.com/duydo/elasticsearch-analysis-vietnamese/releases/download/v7.3.1/elasticsearch-analysis-vietnamese-7.3.1.zip
mv elasticsearch-analysis-vietnamese-7.3.1.zip /tmp
sudo /data/elasticsearch-7.3.1/bin/elasticsearch-plugin install file:/data/elasticsearch-analysis-vietnamese-7.3.1.zip

sudo /data/elasticsearch-7.3.1/bin/elasticsearch-plugin install analysis-icu


** Tải C++ Tokenizer
git clone https://github.com/coccoc/coccoc-tokenizer.git
cd coccoc-tokenizer
mkdir build
cd build
cmake -DBUILD_JAVA=1 ..
make install

** Cài plugin:
cd /es
echo "Y" | ./bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-vietnamese-7.3.1.zip

*** Chuẩn bị
groupadd -g 1999 chanhnv && useradd -r -u 1999 -g chanhnv chanhnv
usermod -aG sudo chanhnv
chown chanhnv:chanhnv /data/elasticsearch-7.3.1 -R
sysctl -w vm.max_map_count=262144

su chanhnv

** Run
export ES_JAVA_OPTS="-Xms2048m -Xmx2048m -Djava.library.path=/usr/local/lib"
cd /data/elasticsearch-7.3.1
./bin/elasticsearch
./bin/elasticsearch -d -p pid

**** Muốn kill thì thực hiện theo các bước lúc run nhưng đổi lệnh cuối

pkill -F pid


**** Download kibana 7.3.1 *****
sudo curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.3.1-linux-x86_64.tar.gz
sudo curl https://artifacts.elastic.co/downloads/kibana/kibana-7.3.1-linux-x86_64.tar.gz.sha512 | shasum -a 512 -c - 
sudo tar -xzf kibana-7.3.1-linux-x86_64.tar.gz

#server.host: "localhost"
server.host: "0.0.0.0"


*** Set up service kibana
sudo nano /etc/systemd/system/kibana.service

[Unit]
Description=Kibana
After=network.target

[Service]
ExecStart=/data/kibana-7.3.1-linux-x86_64/bin/kibana
WorkingDirectory=/data/kibana-7.3.1-linux-x86_64
User=chanhnv
Group=chanhnv
Restart=always
RestartSec=5
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target

groupadd -g 1999 chanhnv && useradd -r -u 1999 -g chanhnv chanhnv


sudo useradd --system --no-create-home --user-group kibana

sudo chown -R chanhnv:chanhnv /path/to/kibana-7.3.1

sudo chown -R chanhnv:chanhnv /data/kibana-7.3.1-linux-x86_64

sudo systemctl daemon-reload

sudo systemctl enable kibana
sudo systemctl start kibana

Thiên Hạo TV:  https://www.youtube.com/@thienhaotv8916/videos

Phi Công vlog: https://www.youtube.com/@PhiCongvlog/videos

lemon coder: https://www.youtube.com/@lemoncoder/videos